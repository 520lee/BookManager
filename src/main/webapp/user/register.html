<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>欢迎使用图书管理系统</title>
    <link rel="shortcut icon" href="../images/fav.ico" />
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <style>
        body{
            background-color: #93defe;
        }
        .col-lg-12{
            font-family: 楷体;
            padding: 1% 5% 1% 5%;
        }
        .col-lg-12 .log-1{
            color: #eee;
            font-size: 30px;
            font-weight: bold;
        }
        .col-lg-12 .log-2{
            color: #eee;
            font-size: 25px;
            margin-left: 3px;
        }
        .col-lg-12 .log-3{
            color: #eee;
            font-size: 20px;
            margin-left: 8px;
        }
        .content{
            padding: 2% 8%;
            margin: 1% 4% 1% 4%;
            background-color: #fff;
            border: 1px solid white;
            border-radius: 10px;
        }
        .btn-box{
            width: 20%;
            margin: 50px 70% 0 30%;
        }
        .btn-box .btn{
            color: #eee;
            font-size: 16px;
            background-color: #27a9e3;
        }
        .star{
            color:#C00;
            vertical-align: middle;
        }
        .glyphicon{
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <span class="log-1">图书</span>
                <span class="log-2">管理系统</span>
                <span class="log-3">账号</span>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <span class="log-1">欢迎使用图书管理系统</span>
            </div>
        </div>
        <div class="row  content">
            <div class="col-lg-8 col-md-8 col-sm-8">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="username" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            账号：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="text" class="form-control" id="username" placeholder="请输入账号" name="username">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="username-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="password" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            密码：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="password" class="form-control" id="password" placeholder="请输入密码" name="password">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="password-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cfmpwd" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            确认密码：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="password" class="form-control" id="cfmpwd" placeholder="请再次输入密码" name="cfmpwd">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="cfmpwd-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            姓名：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="text" class="form-control" id="name" placeholder="姓名" name="name">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="name-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="age" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            年龄：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="text" class="form-control" id="age" placeholder="年龄" name="age">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="age-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sex-male" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            性别：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <label class="radio-inline">
                                <input type="radio" name="sex" id="sex-male" value="男" checked="checked"> 男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="sex" id="sex-female" value="女"> 女
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="col-lg-3 col-md-3 col-sm-4 control-label">
                            <span class="star">*</span>
                            电话：</label>
                        <div class="col-lg-5 col-md-6 col-sm-7">
                            <input type="text" class="form-control" id="phone" placeholder="电话" name="phone">
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1">
                            <span id="phone-status" aria-hidden="true"></span>
                        </div>
                    </div>
                    <div class="btn-box">
                        <button class="btn" type="button">立即注册</button>
                    </div>
                </form>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4">
                > 已经拥有帐号?
                <a href="../index.html">直接登录</a>
            </div>
        </div>
    </div>
<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script>
    $(function () {
        $('input').blur(function () {
            var username = $('#username').val();
            var phone = $('#phone').val();
            if (this.name === "username"){
                var type = "username";
                var str = username;
                if (username){
                    ajax(str,type);
                } else {
                    $('#username-status').attr("class","glyphicon glyphicon-remove");
                }
            }else
            if (this.name === "cfmpwd") {
                if ($('#cfmpwd').val() === $('#password').val() && $('#password').val() != "") {
                    $('#cfmpwd-status').attr("class","glyphicon glyphicon-ok");
                }else {
                    $('#cfmpwd-status').attr("class","glyphicon glyphicon-remove");
                }
            }else
            if (this.name === "phone"){
                var type = "phone";
                var str = phone;
                if (phone){
                    ajax(str,type);
                } else {
                    $('#phone-status').attr("class","glyphicon glyphicon-remove");
                }
            }else
                if (this.name === "password" && $('#cfmpwd').val()) {
                if ($('#cfmpwd').val() === $('#password').val() && $('#password').val() != "") {
                    $('#cfmpwd-status').attr("class","glyphicon glyphicon-ok");
                }else {
                    $('#cfmpwd-status').attr("class","glyphicon glyphicon-remove");
                }
            }else {
                if (this.value != "") {
                    console.log($('#' + this.name));
                    $('#' + this.name + '-status').attr("class","glyphicon glyphicon-ok");
                }else {
                    $('#' + this.name + '-status').attr("class","glyphicon glyphicon-remove");
                }
            }
        });
        $('.btn').click(function () {
            var username = $('#username').val();
            var password = $('#password').val();
            var name = $('#name').val();
            var age = $('#age').val();
            var sex = $('input:radio:checked').val();
            var phone = $('#phone').val();
            console.log(sex);
            if (check($('input'))){
                $.ajax({
                    url: "../user/register.do",
                    type: "post",
                    dataType: "json",
                    data: {
                        username: username,
                        password: password,
                        name: name,
                        age: age,
                        sex: sex,
                        phone: phone
                    },
                    success: function (data) {
                        if (!data.status) {
                            setTimeout(function () {
                                window.location.href='../index.html?username=' + $('#username').val();
                            },2000);
                        }
                    }
                });
            }else {
                alert('请填完正确的信息再提交')
            }
        });
        function ajax(str, type) {
            $.ajax({
                url: "../user/check_valid.do",
                type: "post",
                dataType: "json",
                data: {
                    str: str,
                    type: type
                },
                success: function (data) {
                    if (!data.status){
                        if (type === "username") {
                            $('#username-status').attr("class","glyphicon glyphicon-ok");
                        }
                        if (type === "phone") {
                            $('#phone-status').attr("class","glyphicon glyphicon-ok");
                        }
                    } else {
                        if (type === "username") {
                            $('#username-status').attr("class","glyphicon glyphicon-remove");
                        }
                        if (type === "phone") {
                            $('#phone-status').attr("class","glyphicon glyphicon-remove");
                        }
                    }
                }
            })
        }
        function check(objs) {
            var state = true;
            objs.each(function () {
                if (this.name !== "sex"){
                    console.log(this.value === "");
                    if ($('#'+this.name+'-status').attr("class") === "glyphicon glyphicon-remove" || this.value === "") {
                        state = false;
                    }
                }
            });
            return state;
        }
    });
</script>
</body>
</html>